# NeedPort B2B ピボット仕様書

## 概要
NeedPort の B2B 化に向けた Phase 1 実装。既存の個人/コミュニティ向け機能は変更せず、B2B 機能を段階的に追加。

## 語彙定義

### 既存（変更なし）
- **Need**: ニーズ投稿
- **Entry**: エントリー（個人向け）
- **Offer**: オファー（個人向け）

### B2B 新規
- **Endorsement**: 賛同（Need への支持）
- **Proposal**: 提案（B2B 向け）
- **Contract**: 契約
- **Review**: レビュー
- **Escrow**: エスクロー

## フロー概要

### 1. 賛同フェーズ
1. ユーザーが Need に賛同（Endorsement）
2. 賛同数が閾値に達すると提案解禁
3. 提案者（Proposer）が提案を作成

### 2. 提案フェーズ
1. 提案者が詳細な提案書を作成
2. クライアントが提案を評価
3. 採用決定

### 3. 契約フェーズ
1. 契約書作成
2. エスクロー入金
3. 作業開始

### 4. レビューフェーズ
1. 作業完了
2. レビュー投稿
3. エスクロー決済

## 技術仕様

### Phase 1（現在）
- フィーチャーフラグによる制御
- API は 501 で未実装
- 型定義とスキーマ雛形のみ
- UI 文言の調整

### Phase 2（将来）
- 決済連携（Stripe）
- 認証連携（Clerk）
- エスクロー機能
- 通知システム

## 賛同ピル（Phase 1.5）

### 概要
賛同ピルは Phase 1 のダミー実装であり、実際のデータベースやAPIを参照しません。

### 表示条件
- `EXPERIMENTAL_B2B=1` かつ `NEXT_PUBLIC_SITE_NOINDEX=1` の両方が有効
- どちらかが `0` の場合は表示されない

### 数値生成
- 決定論的生成：同じ Need に対して常に同じ数値（3〜9の範囲）
- シード：`need.id` または `need.title + '|' + need.createdAt`
- 生成関数：`demoEndorseCount()` （DJB2ハッシュベース）

### テスト保証
- 表示条件のテスト：フラグの組み合わせパターンを網羅
- 決定論性のテスト：同じシードで同じ結果を保証
- ネットワーク呼び出し：増加なしを保証

### API差し替え時の注意
Phase 2 で実装する際は、`demoEndorseCount()` を実際のAPI呼び出しに置換してください。
UI契約（表示条件、data属性、クラス名）は変更しないでください。

## 既存機能との互換性
- `/api/needs` の RLS-safe insert は変更なし
- 個人向け機能はそのまま維持
- データベーススキーマは段階的に拡張

## セキュリティ
- RLS ポリシーは後で実装
- 外部キー制約は後で実装
- 決済関連は完全に分離
